<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Draft Beer Regulator Pressure Calculator</title>
    <!-- Include Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Draft Beer System Balancer</h1>

    <!-- Input fields for Calculator -->
    <label>Beer Line Length (feet):</label>
    <input type="number" id="lineLength" value="5"><br>

    <label>Line Resistance per Foot (PSI per foot, default is 2.2 for 3/16" line):</label>
    <input type="number" id="lineResistance" value="2.2" step="0.1"><br>

    <label>Temperature (Celsius):</label>
    <input type="number" id="temperature" value="3"><br>

    <label>Carbonation Level (volumes CO2):</label>
    <input type="number" id="carbonationLevel" value="2.5"><br>

    <label>Keg Height Difference (feet):</label>
    <input type="number" id="kegHeightDifference" value="0"><br>

    <!-- Calculate button -->
    <button onclick="calculateRegulatorPressure()">Calculate Required Regulator Pressure</button>

    <!-- Output section -->
    <h2>Results</h2>
    <p id="output"></p>

    <!-- Chart section -->
    <h2>Equilibrium Pressure Chart</h2>
    <div id="chart"></div>

    <script>
        function calculateRegulatorPressure() {
            // Get values from input fields
            let lineLength = parseFloat(document.getElementById("lineLength").value);
            let lineResistance = parseFloat(document.getElementById("lineResistance").value);
            let temperatureCelsius = parseFloat(document.getElementById("temperature").value);
            let carbonationLevel = parseFloat(document.getElementById("carbonationLevel").value);
            let kegHeightDifference = parseFloat(document.getElementById("kegHeightDifference").value);

            // Convert Celsius to Fahrenheit
            let temperature = (temperatureCelsius * 9/5) + 32;

            // Approximate equilibrium pressure based on temperature and carbonation
            let equilibriumPressure;
            if (temperature === 38 && carbonationLevel === 2.5) {
                equilibriumPressure = 12;
            } else {
                equilibriumPressure = (carbonationLevel - 1) * 7.5 + ((temperature - 32) / 10);
            }

            // Calculate line pressure drop and gravity adjustment
            let linePressureDrop = lineLength * lineResistance;
            let gravityAdjustment = 0.5 * kegHeightDifference;

            // Calculate required PSI at the regulator to balance the system
            let requiredPSI = equilibriumPressure + linePressureDrop + gravityAdjustment;

            // Display the result
            document.getElementById("output").innerText = 
                `Required Regulator Pressure: ${requiredPSI.toFixed(2)} PSI`;
        }

        // Chart Data
        function drawChart() {
            const temperatures = Array.from({length: 19}, (_, i) => i + 32); // Temperatures from 32°F to 50°F
            const carbonationLevels = [2.2, 2.5, 2.7, 3.0];

            const data = carbonationLevels.map(level => {
                const pressures = temperatures.map(temp => (level - 1) * 7.5 + ((temp - 32) / 10));
                return {
                    x: temperatures,
                    y: pressures,
                    type: 'scatter',
                    mode: 'lines',
                    name: `${level} Vol CO2`
                };
            });

            const layout = {
                title: 'Equilibrium Pressure Required for Different Carbonation Levels',
                xaxis: { title: 'Temperature (°F)' },
                yaxis: { title: 'Pressure (PSI)' }
            };

            Plotly.newPlot('chart', data, layout);
        }

        // Draw the chart on page load
        drawChart();
    </script>
</body>
</html>
